Subj:  'discp.f'Date:  Mon, Aug 19, 1996 7:03 AM PSTFrom:  znmeb@teleport.comTo:	OuversonM@aol.com\ Dijkstra Guarded Command Control Structures\ M. Edward Borasky\ 03-AUG-96\\ This code has been tested with both hForth 0.9.7 and ZENForth.\ To compile for hForth, type\\    0 CONSTANT ZENForth\\ To compile for ZENForth, type\\    1 CONSTANT ZENForth\\ Then type\\    BL PARSE DISCP.F INCLUDED\\ These words were designed using Wonyong Koh's hForth 0.9.7,\ They should work with minor modifications on any ANS Forth\ system providing the words listed below.\ Environmental dependencies:\\ Requires AGAIN from the CORE EXT word set\ Requires AHEAD from the TOOLS EXT word set\ Requires CS-PICK from the TOOLS EXT word set\ Requires CS-ROLL from the TOOLS EXT word set\ Requires PICK from the CORE EXT word set\ Requires ROLL from the CORE EXT word set\ Requires THROW from the EXCEPTION word set\ Requires hForth word dest+ or equivalent\ Requires hForth word COMPILE-ONLY or equivalent\ Requires .( from CORE EXT word set (test sequence only)\ hForth does not have CS-PICK or CS-ROLL.  However, hForth\ uses the data stack as control flow stack, so they can be\ defined simply:: CS-PICK PICK ;: CS-ROLL ROLL ;\ hForth has the capability to flag a word COMPILE-ONLY.  On \ other systems, COMPILE-ONLY can be ignored by defining it as\ follows:ZENForth [IF] \ ZENForth compatibility        : COMPILE-ONLY ;[THEN]: {IF \ start a conditional        ( -- 0 )        0 \ put counter on stack; COMPILE-ONLY IMMEDIATE: IF> \ right-arrow for {IF ... FI}        ( count -- count+1 )        ( C: -- orig1 )        1+ >R \ increment and save count         POSTPONE IF \ create orig1        R> \ restore count; COMPILE-ONLY IMMEDIATE: |IF| \ bar for {IF ... FI}        ( count -- count )        ( C: orig ... orig1 -- orig ... orig2 )        >R \ save count        POSTPONE AHEAD \ new orig        1 CS-ROLL \ old orig to top of CFStack        POSTPONE THEN \ resolve old orig        R> \ restore count; COMPILE-ONLY IMMEDIATE: BAD{IF...FI} \ abort if there is no TRUE condition        ( -- )        CR ." {IF ... FI}: no TRUE condition" CR \ error message        -22 THROW \ 'control structure mismatch';: FI} \ end of conditional        ( count -- )        ( C: orig1 ... orign -- )        >R \ save count        POSTPONE AHEAD \ new orig        1 CS-ROLL \ old orig        POSTPONE THEN \ resolve old orig        \ if we got here, none of the guards were TRUE        \ so abort        POSTPONE BAD{IF...FI} \ compile the abort        R> \ restore count        0 ?DO \ resolve all remaining origs                POSTPONE THEN        LOOP; COMPILE-ONLY IMMEDIATE: {DO \ start a loop        ( C: -- dest )        POSTPONE BEGIN \ create dest; COMPILE-ONLY IMMEDIATE        : DO> \ right arrow for {DO ... OD}        ( C: dest -- orig1 dest )        POSTPONE IF \ create orig        1 CS-ROLL \ bring dest back to top of CFStack; COMPILE-ONLY IMMEDIATE\ hForth uses the word 'dest+' to count open destinations.  For\ other environments, there may be a similar word.ZENForth [IF]        : dest+ 1 bal +! ;[THEN]: |DO| \ bar for {DO ... OD}        ( C: orig1 dest -- dest )        0 CS-PICK \ copy the dest        POSTPONE AGAIN \ resolve the copy        dest+ \ hForth control structure operation        1 CS-ROLL \ old orig        POSTPONE THEN \ resolve old orig; COMPILE-ONLY IMMEDIATE: OD} \ end of loop        ( C: orig dest -- )        POSTPONE AGAIN \ resolve dest        POSTPONE THEN \ resolve orig; COMPILE-ONLY IMMEDIATE\ Simple test words: TEST1 \ print the relationship between 'x' and 'y'        ( x y -- )        {IF                 2DUP = IF> CR ." = "        |IF|                2DUP > IF> CR ." > "        |IF|                2DUP < IF> CR ." < "        FI}        2DROP;        \ execute TEST1 for all three combinationsCR .( 5 0 TEST1 )5 0 TEST1CR .( 5 5 TEST1 )5 5 TEST1CR .( 0 5 TEST1 )0 5 TEST1: TEST2 \ deliberately erroneous test case --         \ 'equal' case left out!        ( x y -- )        {IF                2DUP < IF> CR ." < "        |IF|                2DUP > IF> CR ." > "        FI}        2DROP;        CR .( Since TEST2 aborts if 'x' and 'y' are equal, we will )CR .( test TEST2 later; first we will compile and test USEFUL )\ define argumentsVARIABLE x  5 6553 * x !VARIABLE y 6551 5 * y !: USEFUL \ sets both 'x' and 'y' to GCD(x, y)        ( -- )        {DO                x @ y @ > DO> y @ NEGATE x +!        |DO|                y @ x @ > DO> x @ NEGATE y +!        OD};CR .( Before: x, y = ) x @ . y @ . CRCR .( USEFUL ) USEFULCR .( After: x, y = ) x @ . y @ . CRCR .( Now we'll test TEST2 )CR .( 5 0 TEST2 )5 0 TEST2CR .( 0 5 TEST2 )0 5 TEST2CR .( 5 5 TEST2 )5 5 TEST2\ That's all, folks!!-- znmeb@teleport.com (M. Edward Borasky) http://www.teleport.com/~znmebThe American people are tired of being told what the American people are tired of.----------------------- Headers --------------------------------From znmeb@teleport.com  Mon Aug 19 11:02:30 1996Return-Path: znmeb@teleport.comReceived: from desiree.teleport.com (desiree.teleport.com [192.108.254.21]) by emin17.mail.aol.com (8.6.12/8.6.12) with ESMTP id LAA29972 for <OuversonM@aol.com>; Mon, 19 Aug 1996 11:02:18 -0400From: znmeb@teleport.comReceived: from julie.teleport.com (znmeb@julie.teleport.com [192.108.254.19]) by desiree.teleport.com (8.7.5/8.7.3) with ESMTP id IAA02391 for <OuversonM@aol.com>; Mon, 19 Aug 1996 08:02:14 -0700 (PDT)Received: (from znmeb@localhost) by julie.teleport.com (8.7.5/8.7.3) id IAA13608 for OuversonM@aol.com; Mon, 19 Aug 1996 08:02:11 -0700 (PDT)Message-Id: <199608191502.IAA13608@julie.teleport.com>Subject: 'discp.f'To: OuversonM@aol.comDate: Mon, 19 Aug 1996 08:02:11 -0700 (PDT)X-Mailer: ELM [version 2.4 PL25]Content-Type: text